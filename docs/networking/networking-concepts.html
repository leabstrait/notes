<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Networking Concepts</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Networking Concepts</h1>
</header>
<h1 class="unnumbered" id="slides">Slides</h1>
<p><a
href="files/networking-concepts/Fundamentals+of+Networking+for+Effective+Backends-v5.pdf">Slides</a></p>
<h1 class="unnumbered"
id="standard-communication-models-for-networking">Standard communication
models for Networking</h1>
<p>A standard model allows decoupling, so that the layers can be worked
on or upgraded without worrying about the rest.</p>
<h2 class="unnumbered" id="osi-open-systems-interconnect-model">OSI
(Open Systems Interconnect) Model</h2>
<p><a href="https://en.wikipedia.org/wiki/OSI_model">OSI (Open Systems
Interconnect) Model</a></p>
<p>7 Layers each describe a specific networking component</p>
<ul>
<li><p>Layer 7 - Application - HTTP/FTP/gRPC</p></li>
<li><p>Layer 6 - Presentation - Encoding, Serialization</p></li>
<li><p>Layer 5 - Session - Connection establishment, TLS</p></li>
<li><p>Layer 4 - Transport - UDP/TCP</p></li>
<li><p>Layer 3 - Network - IP</p></li>
<li><p>Layer 2 - Data link - Frames, Mac address Ethernet</p></li>
<li><p>Layer 1 - Physical - Electric signals, fiber or radio
waves</p></li>
</ul>
<h2 class="unnumbered"
id="the-tcpip-model-or-internet-protocol-suite">The TCP/IP Model or
Internet Protocol Suite</h2>
<p><a href="https://en.wikipedia.org/wiki/Internet_protocol_suite">The
TCP/IP Model or Internet Protocol Suite</a></p>
<p>Much simpler than OSI, just 4 layers</p>
<ul>
<li><p>Application (Layer 5, 6 and 7)</p></li>
<li><p>Transport (Layer 4)</p></li>
<li><p>Internet (Layer 3)</p></li>
<li><p>Data link (Layer 2)</p></li>
</ul>
<p>Physical layer is not officially covered in the model</p>
<h1 class="unnumbered" id="data-link-layer">Data Link Layer</h1>
<h2 class="unnumbered" id="arp-address-resolution-protocol">ARP (Address
Resolution Protocol)</h2>
<p>It is used to translate IP addresses to MAC addresses, since IPs are
changeable and MAC addresses are (usually) fixed. ARP is local.</p>
<p><a
href="https://www.tcpdump.org/manpages/tcpdump.1.html"><code>tcpdump</code></a></p>
<p>Tcpdump prints out a description of the contents of packets on a
network interface.</p>
<p><code>tcpdump -n -i wlp3s0 arp</code></p>
<p><code>tcpdump</code> with src and dst filters</p>
<p><code>tcpdump -n -v -i wlp3s0 src 192.168.1.2 or dst 142.243.66.23</code></p>
<p>To deliver the packet to the destination host, the source IP,
destination IP, source MAC address, and destination MAC address should
be known. Some basic rules for the packet flow:</p>
<ul>
<li><p>If the destination host is present in the same network, then the
packet is delivered directly to the destination host.</p></li>
<li><p>If the destination host is present in a different network, then
the packet is delivered to the default gateway first which in turn
delivers the packet to the destination host.</p></li>
<li><p>If ARP is not resolved then ARP will be resolved first.</p></li>
<li><p>MAC address never crosses its broadcast domain.</p></li>
</ul>
<h2 class="unnumbered" id="host-to-host-communication">Host to Host
Communication</h2>
<p>Finding a device with a unique MAC address in a network is done by
sending requests to all devices in the network. Only the device with the
intended MAC address accepts the connection. But when the network is of
a bigger scale than a simple home network, this method is not possible
to scale. This is where IP addresses and routers come into play. Routers
have two different IP addresses for the two networks they are
connecting. When sending an IP packet (layer 3, router) there is a
process of AND (&amp;)ing with the subnet mask to find out if the packet
is destined to the same network or another, and passing forward until
the TTL of the packet goes to zero or the destination is found.</p>
<p><strong>TTL - Time to Live</strong> - this gives the count of how
many hops a packet can survive. <strong>TTL</strong> is decreased by 1
every hop. TTL is needed because without it the packets might hop from
router to router indefinitely.</p>
<p><em>Note [Optimization]</em> Keeping your server and database in the
same subnet will be more efficient than those two being in separate
subnets. Because the subnets are usually connected by a router (the
routers live in both networks), if the router is congested, we are gonna
see delays. Instead, we can use a switch in between the database and the
backend.</p>
<h1 class="unnumbered" id="network-layer">Network Layer</h1>
<p><a href="https://en.wikipedia.org/wiki/Internet_Protocol">IP</a> is
the network layer communications protocol.</p>
<p>IP Addresses are a layer 3 property. Can be set automatically or
statically, has <em>network</em> and <em>host</em> portions. 4 bytes in
IPv4 - 32 bits.</p>
<ul>
<li><p>a.b.c.d/x (a, b, c, d, x are integers). x is the network bits,
remaining are the host. <a
href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing">CIDR
Notation</a></p></li>
</ul>
<h2 class="unnumbered" id="icmp-internet-control-message-protocol">ICMP
(Internet Control Message Protocol)</h2>
<p>It is used by network devices, including routers, to send error
messages and operational information indicating success or failure when
communicating with another IP address. It is used by ping and
traceroute.</p>
<p><code>ping google.com</code></p>
<p><code>traceroute google.com</code></p>
<p><code>tcpdump -n -i wlp3s0 icmp</code></p>
<h1 class="unnumbered" id="transport-layer">Transport Layer</h1>
<h2 class="unnumbered" id="udp-user-datagram-protocol"><a
href="https://en.wikipedia.org/wiki/User_Datagram_Protocol">UDP (User
Datagram Protocol)</a></h2>
<p>Layer 4 protocol, sits on top of the IP protocol (Network layer).
While IP can address a host using IP addresses, UDP has the ability to
address processes in a host using ports. Simpler and stateless protocol,
compared to TCP. Has 8-byte header on top of 20 bytes of the IP packet.
Used for:</p>
<ul>
<li><p>Video Streaming</p></li>
<li><p>VPN</p></li>
<li><p>DNS</p></li>
<li><p>WebRTC uses UDP. Websockets, on the other hand, use TCP</p></li>
<li><p>Games</p></li>
<li><p>P2P</p></li>
</ul>
<p>Multiplexing (many to one) and demultiplexing (one to many). IP
targets hosts only. Each host can have multiple applications running.
Ports can be used to identify the ’apps’ or ’processes’. The sender
multiplexes all inputs into single IP packets into UDP, and the receiver
demultiplexes UDP datagrams in IP packets to each app or process. A
four-tuple (Source IP, Source Port, Destination IP, Destination Port)
can represent every communication between two devices.</p>
<p><em>Note</em> Every time there is a mapping like in DNS, ARP tables,
there’s a chance of poisoning - ARP poisoning, DNS poisoning.</p>
<p><em>Note</em> Because we have 65535 ports, we can have a maximum of
65535 connections (theoretically) between a client IP and a single
server process assuming the client uses all its ports to connect to the
server process. Practically though, some of the ports are already
reserved.</p>
<p>Capturing DNS server requests and responses using
<code>tcpdump</code>:</p>
<p><code>nslookup google.com 8.8.8.8</code></p>
<p><code>tcpdump -n -v -i wlp3s0 src 8.8.8.8 or dst 8.8.8.8</code></p>
<h2 class="unnumbered" id="tcp-transmission-control-protocol"><a
href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol">TCP
(Transmission Control Protocol)</a></h2>
<p>Similar to UDP, it’s a Layer 4 protocol and can address processes in
a host using ports. It ’controls’ the transmission, unlike UDP which is
like a firehose. Requires a connection before transmitting data.
Connection is made using a ’handshake’. Hence it’s stateful. Has 20
bytes header. Used for reliable communications like:</p>
<ul>
<li><p>Remote Shell</p></li>
<li><p>Database Connections</p></li>
<li><p>Web Communications (HTTP1, HTTP2 is built on top of TCP, HTTP3 is
built on top of QUIC which is built on top of UDP and aims to be better
than TCP)</p></li>
<li><p>Any bidirectional communication</p></li>
</ul>
<p>TCP Connection is a Layer 5 (session) concept. The connection between
client and server must be there to send data, can’t send data outside of
a connection, requires a 3-way TCP handshake.</p>
<p>The connection is identified by four properties (Source IP, Source
Port, Destination IP, Destination Port). These four properties are
combined and hashed and saved as a file descriptor (also called
sockets).</p>
<p><em>Note</em> Socket often refers specifically to an internet socket
or TCP socket. An internet socket is minimally characterized by the
following:</p>
<ul>
<li><p>local socket address, consisting of the local IP address and (for
TCP and UDP, but not IP) a port number</p></li>
<li><p>protocol: A transport protocol, e.g., TCP, UDP, raw IP. This
means that (local or remote) endpoints with TCP port 53 and UDP port 53
are distinct sockets, while IP does not have ports.</p></li>
<li><p>A socket that has been connected to another socket, e.g., during
the establishment of a TCP connection, also has a remote socket
address.</p></li>
</ul>
<p>The Transmission Control Protocol differs in several key features
compared to the User Datagram Protocol:</p>
<ul>
<li><p>Ordered data transfer: the destination host rearranges segments
according to a sequence number</p></li>
<li><p>Retransmission of lost packets: any cumulative stream not
acknowledged is retransmitted</p></li>
<li><p>Error-free data transfer: corrupted packets are treated as lost
and are retransmitted</p></li>
<li><p>Flow control: limits the rate a sender transfers data to
guarantee reliable delivery. The receiver continually hints the sender
on how much data can be received (receiver sends an <code>ACK</code>
with its window size[max 64KB but can be scaled up with the window
scaling factor(0-14), so hat window size can go upto 1GB]). When the
receiving host’s buffer fills, the next acknowledgment suspends the
transfer and allows the data in the buffer to be processed. Employs a
<code>window sliding mechanism</code>.</p></li>
<li><p>Congestion control: the receiver might handle the load but the
middle boxes(routers) might not. lost packets (presumed due to
congestion) trigger a reduction in data delivery rate</p></li>
</ul>
<h3 class="unnumbered" id="maximum-segment-size">Maximum Segment
Size</h3>
<p><a
href="https://www.cloudflare.com/learning/network-layer/what-is-mss/">MSS
(maximum segment size)</a> limits the size of packets, or small chunks
of data, that travel across a network. MSS measures the non-header
portion of a packet, which is called the payload. MSS is determined by
another metric that has to do with packet size: <a
href="https://www.cloudflare.com/learning/network-layer/what-is-mtu/">MTU
(maximum transmission unit)</a>, which does include the TCP and IP
(Internet Protocol) headers.</p>
<p>Essentially, the MSS is equal to MTU minus the size of a TCP header
and an IP header:</p>
<p><span
class="math display"><em>M</em><em>T</em><em>U</em> − (<em>T</em><em>C</em><em>P</em><em>h</em><em>e</em><em>a</em><em>d</em><em>e</em><em>r</em>+<em>I</em><em>P</em><em>h</em><em>e</em><em>a</em><em>d</em><em>e</em><em>r</em>) = <em>M</em><em>S</em><em>S</em></span></p>
<div class="center">
<figure>
<img src="files/networking-concepts/data-packet.png" />
<figcaption>A data packet</figcaption>
</figure>
</div>
<p>One of the key differences between MTU and MSS is that if a packet
exceeds a device’s MTU, it is broken up into smaller pieces, or
"fragmented." In contrast, if a packet exceeds the MSS, it is dropped
and not delivered.</p>
<p>The maximum MTU of the internet is 1500 bytes, and the maximum MSS is
1460 bytes.</p>
<p>&gt; Since then various other transmission systems have come and
gone, but the lowest MTU value of them has still been Ethernet at 1500
bytes. Going bigger than the lowest MTU on a network will either result
in IP fragmentation, or the need to do path MTU detection. Both of which
have their own sets of problems. Even if sometimes large OS vendors
dropped the default MTU to even lower at times.</p>
<h2 class="unnumbered" id="nat-network-address-translation">NAT (Network
Address Translation)</h2>
<p>IPV4 has a limit of 4 billion adressess which is not enough
considering the number of devices connected to the Internet.IPV6 also
solves this issue but for IPV4 adressing, NAT allows multiples of
devices to access the internet while also remaining private inside a
network. It gives one public IP address(the gateway) and multiple
private adresses for internal use. While it was inventeted to help with
the ipv4 addressing issue, NAT also has a usecase for Layer 4 load
balancing.</p>
<p>All devices have the same public IP address which is the router. The
source port and IP adress is being mapped to a different source Port and
IP for communication with the internet. This mapping called the ’NAT
table’ lives in the router has mappings to/from public and private
ip-port pairs.</p>
<p>NAT uses the IP ranges - 192.168.x.x, 10.0.0.x allocated specifically
for private networks.</p>
</body>
</html>
